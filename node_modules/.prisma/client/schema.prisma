// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Exam {
  id           String     @id @default(uuid())
  title        String
  year         Int
  organization String
  institution  String
  level        String
  sourceUrl    String?
  examPdfUrl   String?
  answerKeyUrl String?
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  questions    Question[]

  @@map("exams")
}

model Question {
  id           String        @id @default(uuid())
  statement    String
  organization String
  subject      String
  examId       String?
  exam         Exam?         @relation(fields: [examId], references: [id])
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  alternatives Alternative[]

  @@map("questions")
}

model Alternative {
  id         String   @id @default(uuid())
  text       String
  isCorrect  Boolean  @default(false)
  questionId String
  question   Question @relation(fields: [questionId], references: [id], onDelete: Cascade)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@map("alternatives")
}

model Simulation {
  id         String             @id @default(uuid())
  studentId  String
  title      String
  createdAt  DateTime           @default(now())
  finishedAt DateTime?
  answers    SimulationAnswer[]

  @@map("simulations")
}

model SimulationAnswer {
  id            String     @id @default(uuid())
  simulationId  String
  simulation    Simulation @relation(fields: [simulationId], references: [id], onDelete: Cascade)
  questionId    String
  alternativeId String
  createdAt     DateTime   @default(now())

  @@unique([simulationId, questionId])
  @@map("simulation_answers")
}

model Organization {
  id          String       @id @default(uuid())
  externalId  Int          @unique
  name        String
  acronym     String?
  sphere      String?
  state       String?
  slug        String?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  examRecords ExamRecord[]

  @@map("organizations")
}

model Board {
  id          String       @id @default(uuid())
  externalId  Int          @unique
  name        String
  description String?
  acronym     String?
  isOab       Boolean      @default(false)
  slug        String?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  examRecords ExamRecord[]

  @@map("boards")
}

model Position {
  id          String       @id @default(uuid())
  externalId  Int          @unique
  name        String
  description String?
  slug        String?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  examRecords ExamRecord[]

  @@map("positions")
}

model Notice {
  id                 String       @id @default(uuid())
  externalId         Int          @unique
  slug               String?
  enrollmentStart    DateTime?
  enrollmentEnd      DateTime?
  plannedApplication DateTime?
  createdAt          DateTime     @default(now())
  updatedAt          DateTime     @updatedAt
  examRecords        ExamRecord[]

  @@map("notices")
}

model Career {
  id          String             @id @default(uuid())
  externalId  Int                @unique
  name        String
  description String?
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  exams       ExamRecordCareer[]

  @@map("careers")
}

model Area {
  id         String           @id @default(uuid())
  externalId Int              @unique
  name       String
  slug       String?
  createdAt  DateTime         @default(now())
  updatedAt  DateTime         @updatedAt
  exams      ExamRecordArea[]

  @@map("areas")
}

model ExamRecord {
  id               String             @id @default(uuid())
  externalId       Int                @unique
  slug             String             @unique
  name             String
  type             Int
  year             Int
  level            String
  questionCount    Int
  durationMinutes  Int?
  reviewed         Boolean            @default(false)
  hasPendencies    Boolean            @default(false)
  available        Boolean            @default(false)
  observations     String?
  otherData        String?
  timestamp        DateTime?
  publishedAt      DateTime?
  applicationDate  DateTime?
  examFileKey      String?
  answerKeyFileKey String?
  organizationId   String
  boardId          String
  positionId       String
  noticeId         String?
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @updatedAt
  organization     Organization       @relation(fields: [organizationId], references: [id])
  board            Board              @relation(fields: [boardId], references: [id])
  position         Position           @relation(fields: [positionId], references: [id])
  notice           Notice?            @relation(fields: [noticeId], references: [id])
  careers          ExamRecordCareer[]
  areas            ExamRecordArea[]
  parts            ExamRecordPart[]

  @@map("exam_records")
}

model ExamRecordCareer {
  id           String     @id @default(uuid())
  examRecordId String
  careerId     String
  examRecord   ExamRecord @relation(fields: [examRecordId], references: [id])
  career       Career     @relation(fields: [careerId], references: [id])

  @@unique([examRecordId, careerId])
  @@map("exam_record_careers")
}

model ExamRecordArea {
  id           String     @id @default(uuid())
  examRecordId String
  areaId       String
  examRecord   ExamRecord @relation(fields: [examRecordId], references: [id])
  area         Area       @relation(fields: [areaId], references: [id])

  @@unique([examRecordId, areaId])
  @@map("exam_record_areas")
}

model ExamRecordPart {
  id           String     @id @default(uuid())
  examRecordId String
  externalId   Int?
  description  String
  examRecord   ExamRecord @relation(fields: [examRecordId], references: [id])

  @@map("exam_record_parts")
}
